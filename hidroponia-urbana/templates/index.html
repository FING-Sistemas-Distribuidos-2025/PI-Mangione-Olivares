<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Medidas y Estadísticas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>Dashboard de Medidas y Estadísticas</h1>
    </header>

    <main>
        <section class="statistics">
            <h2>Estadísticas Recientes</h2>
            <div class="stats-grid">
                {% for measure, stats in stats.items() %}
                <div class="stat-card">
                    <h3>{{ measure.replace('_', ' ').title() }}</h3>
                    <p><strong>Min:</strong> {{ stats.min }}</p>
                    <p><strong>Max:</strong> {{ stats.max }}</p>
                    <p><strong>Promedio:</strong> {{ stats.avg }}</p>
                    <p><strong>Desviación Estándar:</strong> {{ stats.std_dev }}</p>
                </div>
                {% endfor %}
            </div>
        </section>

        <section class="charts">
            <h2>Historial de Medidas</h2>
            <div class="chart-container">
                <canvas id="temperaturaChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="humedadChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="presionChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="energiaChart"></canvas>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Dashboard de Medidas. Todos los derechos reservados.</p>
    </footer>

    <script>
        // Datos pasados desde Flask
        const sensorData = {{ sensor_data_json | tojson }};
        const labels = sensorData.map(d => d.time);

        // Función para crear un gráfico
        function createChart(ctx, type, labels, data, labelText, backgroundColor, borderColor) {
            new Chart(ctx, {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: labelText,
                        data: data,
                        backgroundColor: backgroundColor,
                        borderColor: borderColor,
                        borderWidth: 1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // Obtener contextos de los canvas
        const tempCtx = document.getElementById('temperaturaChart').getContext('2d');
        const humidCtx = document.getElementById('humedadChart').getContext('2d');
        const presionCtx = document.getElementById('presionChart').getContext('2d');
        const energiaCtx = document.getElementById('energiaChart').getContext('2d');

        // Extraer datos para los gráficos
        const temperaturas = sensorData.map(d => d.temperatura);
        const humedades = sensorData.map(d => d.humedad);
        const presiones = sensorData.map(d => d.presion);
        const energias = sensorData.map(d => d.consumo_energia);


        // Crear los gráficos
        createChart(tempCtx, 'line', labels, temperaturas, 'Temperatura (°C)', 'rgba(255, 99, 132, 0.2)', 'rgba(255, 99, 132, 1)');
        createChart(humidCtx, 'line', labels, humedades, 'Humedad (%)', 'rgba(54, 162, 235, 0.2)', 'rgba(54, 162, 235, 1)');
        createChart(presionCtx, 'line', labels, presiones, 'Presión (hPa)', 'rgba(75, 192, 192, 0.2)', 'rgba(75, 192, 192, 1)');
        createChart(energiaCtx, 'line', labels, energias, 'Consumo Energía (kWh)', 'rgba(153, 102, 255, 0.2)', 'rgba(153, 102, 255, 1)');

    </script>
</body>
</html>
